
@{
    Layout = "~/Views/Shared/_THCUI.cshtml";
}

<body class=" bg5">

    <div id="page">

        <nav id="menu">
        </nav>
        <div class="header-bar" style="margin-top: 1em">
            <i class="fa fa-backward fa-2x barFixed" aria-hidden="true"></i>
        </div>
        <div class="content">

            <div class="logo w50">
                <img src="~/images/logo_blk.png" class="logo-img" />
            </div>
            <section id="msg">
                <div class="container">

                    <dir class="row">&nbsp;</dir>
                    <dir class="row">&nbsp;</dir>
                    <dir class="row">&nbsp;</dir>
                    <dir class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8"><label id="lbl_mail">帳號</label></div>
                        <div class="col-xs-2"></div>
                    </dir>
                    <dir class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8">
                            <input id="txt_mail" name="txt_mail" type="text" class="form-control qpid-input" style="width:100%;" placeholder="MAIL信箱或手機" />
                        </div>
                        <div class="col-xs-2"></div>
                    </dir>
                    <dir class="row">&nbsp;</dir>
                    <dir class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8"><label id="lbl_pwd">密碼</label></div>
                        <div class="col-xs-2"></div>
                    </dir>
                    <dir class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8">
                            <input id="txt_pwd" name="txt_pwd" type="password" class="form-control qpid-input" style="width:100%;" placeholder="登入密碼" />
                        </div>
                        <div class="col-xs-2"></div>
                    </dir>
                    <dir class="row">&nbsp;</dir>
                    <dir class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8" style="text-align:center;">
                            <p id="rep_message" name="rep_message" style="color:red!important;"></p>
                        </div>
                        <div class="col-xs-2"></div>
                    </dir>
                </div>

            </section>

            <div class="row" style="position:fixed; bottom: 5%; width: 100%;">
                <div class="col-xs-8 col-xs-offset-2">
                    <button id="btn_login" name="btn_login" type="button" class="form-control ok-btn">登入</button>
                </div>
            </div>

        </div>
    </div>

    <script>

        var ACTIVITY = '';
        var CODE = '';

        $(document).ready(function () {

            @{
             if (!string.IsNullOrEmpty(ViewBag.CODE))
             {
                 <text>
            CODE = '@ViewBag.CODE';

            </text>
             }

             if (!string.IsNullOrEmpty(ViewBag.ACTIVITY))
             {
                 <text>
            ACTIVITY = '@ViewBag.ACTIVITY';

            </text>
             }

         }


            $("#btn_login").click(function () {

                var hasEmpty = false;
                var mail = $("#txt_mail").val();
                if (mail.length == 0) {
                    $("#lbl_mail").css('color', 'red');
                    hasEmpty = true;
                } else {
                    $("#lbl_mail").css('color', 'black');
                }
                var pwd = $("#txt_pwd").val();
                if (pwd.length == 0) {
                    $("#lbl_pwd").css('color', 'red');
                    hasEmpty = true;
                } else {
                    $("#lbl_pwd").css('color', 'black');
                }

                if (hasEmpty) {
                    return false;
                }

                var data = "mail=" + mail + "&pwd=" + pwd;
                $.ajax({
                    async: false,
                    type: "POST",
                    url: '@Url.Content("~/")register/verifyAccount',
                    data: data,
                    dataType: 'json',
                    success: function (data, status, xhr) {

                        jDatas = jQuery.parseJSON(data);
                        if (jDatas.length == 1) {
                            if (jDatas[0].VERIFY == '1') {

                                window.location.href = '@Url.Content("~/")THC/go?ac=' +
                                        ACTIVITY + '&code=' + CODE + '&tk=' + jDatas[0].TICKET + '&ml=' + jDatas[0].ACC;
                            } else {
                                $("#rep_message").text(jDatas[0].MESSAGE);
                            }
                        } else {
                            if (jDatas.ErrorMessage) {
                                $("#rep_message").text(jDatas.ErrorMessage);
                            }
                        }
                    },
                    error: function (request, error) {
                        alert(error + " : " + request.responseText);
                    },
                    complete: function () {

                    }
                });

            });

        });


    </script>

</body>