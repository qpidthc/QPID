
@{
    ViewBag.Title = "rewardPage";
    Layout = "~/Views/Shared/_THCUI.cshtml";
}

<body class=" bg5">

    <div id="page ">

        <nav id="menu">
        </nav>
        <div class="header-bar">
        </div>
        <div class="content">

            <div class="logo w50">
                <img src="~/images/Logo_sm.png" class="logo-sm" />
            </div>          
            <section id="msg">
                <div class="container">
                    
                    <div class="row">
                        <div class="col-md-12" style="width:50%;margin:0px auto;border: 2px #6E6E6E ;border-style: solid;text-align:center; vertical-align:middle; font-size:1.5em;padding:10px;color: #595959">
                            <img src="~/@ViewBag.RWD_IMG" style="width:100px;height:130px;" />                            
                        </div>                        
                    </div>
                    <div class="row">&nbsp;</div>
                    <div class="row">
                        <div class="col-md-12" style="width:70%;margin:0px auto;border: 0px #6E6E6E ;border-style: solid; vertical-align:middle; font-size:1.5em;padding:10px;color: #595959">
                            <section>
                                系統會發送兌獎序號到
                                您的手機，請確認輸入的
                                手機號碼能收到簡訊。
                            </section>
                        </div>

                    </div>


                    <div class="row" style="display:none;">
                        <div class="col-xs-4" style="text-align:right;padding-right:10px;">
                            <p>獎項名稱</p>
                        </div>
                        <div class="col-xs-8" style="text-align:left;">
                            <p>@ViewBag.RWD_NAME</p>
                        </div>
                    </div>

                    <div class="row" style="display:none;">
                        <div class="col-xs-4" style="text-align:right;padding-right:10px;">
                            <p>中獎序號</p>
                        </div>
                        <div class="col-xs-8" style="text-align:left;">
                            <p style="font-size:28px;color:blue!important;">@ViewBag.RWD_COUPNUMBER</p>
                        </div>
                    </div>

                    <div class="row" style="display:none;">
                        <div class="col-xs-4" style="text-align:right;padding-right:10px;">
                            <p>有效期間</p>
                        </div>
                        <div class="col-xs-8" style="text-align:left;">
                            <p style="font-size:24px;color:blue!important;">@ViewBag.RWD_DATE</p>
                        </div>
                    </div>
                                       
                    <div class="row">&nbsp;</div>
                    <div class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8"><label id="lbl_mobil">請輸入手機號碼</label></div>
                        <div class="col-xs-2"></div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8">
                            @{
                                if (string.IsNullOrEmpty(ViewBag.MOBIL))
                                {
                                    <input id="txt_mobil" name="txt_mobil" type="number" class="form-control qpid-input" style="width:100%;" placeholder="輸入手機" />
                                }
                                else
                                {
                                    <input id="txt_mobil" name="txt_mobil" type="text" value="@ViewBag.MOBIL" class="form-control qpid-input" style="width:100%;" placeholder="輸入手機" />
                                }
                            }

                        </div>
                        <div class="col-xs-2"></div>
                    </div>
                    <div class="row">&nbsp;</div>
                    <div class="row" style="display:none;">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8"><label id="lbl_gender">性別</label></div>
                        <div class="col-xs-2"></div>
                    </div>
                    <div class="row" style="display:none;">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8">
                            <select id="sel_gender" name="sel_gender" class=" qpid-select" style="width:100%;">
                                @{
                                    if (string.IsNullOrEmpty(ViewBag.GENDER))
                                    {
                                        <option value="">請選擇</option>
                                        <option value="1">男</option>
                                        <option value="0">女</option>
                                        <option value="2">彩虹</option>
                                    }
                                    else
                                    {
                                        <option value="">請選擇</option>
                                        if (ViewBag.GENDER == "1")
                                        {
                                            <option value="1" selected="selected">男</option>
                                        }
                                        else
                                        {
                                            <option value="1">男</option>
                                        }
                                        if (ViewBag.GENDER == "0")
                                        {
                                            <option value="0" selected="selected">女</option>
                                        }
                                        else
                                        {
                                            <option value="0">女</option>
                                        }
                                        if (ViewBag.GENDER == "2")
                                        {
                                            <option value="2" selected="selected">彩虹</option>
                                        }
                                        else
                                        {
                                            <option value="2">彩虹</option>
                                        }
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-xs-2"></div>
                    </div>
                    <div class="row" style="display:none;">&nbsp;</div>
                    <div class="row" style="display:none;">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8"><label id="lbl_age">年齡</label></div>
                        <div class="col-xs-2"></div>
                    </div>
                    <div class="row" style="display:none;">
                        <div class="col-xs-2"></div>
                        <div class="col-xs-8">
                            <select id="sel_age" name="sel_age" class=" qpid-select" style="width:100%;">

                                @{
                                    if (string.IsNullOrEmpty(ViewBag.AGE))
                                    {
                                        <option value="">請選擇</option>
                                        <option value="1">10-20</option>
                                        <option value="2">20-30</option>
                                        <option value="3">30-40</option>
                                        <option value="4">40-50</option>
                                        <option value="5">50-60</option>
                                        <option value="6">60-70</option>
                                        <option value="7">70 以上</option>
                                    }
                                    else
                                    {
                                        <option value="">請選擇</option>
                                        if (ViewBag.AGE == "1")
                                        {
                                            <option value="1" selected="selected">10-20</option>
                                        }
                                        else
                                        {
                                            <option value="1">10-20</option>
                                        }
                                        if (ViewBag.AGE == "2")
                                        {
                                            <option value="2" selected="selected">20-30</option>
                                        }
                                        else
                                        {
                                            <option value="2">20-30</option>
                                        }
                                        if (ViewBag.AGE == "3")
                                        {
                                            <option value="3" selected="selected">30-40</option>
                                        }
                                        else
                                        {
                                            <option value="3">30-40</option>
                                        }
                                        if (ViewBag.AGE == "4")
                                        {
                                            <option value="4" selected="selected">40-50</option>
                                        }
                                        else
                                        {
                                            <option value="4">40-50</option>
                                        }
                                        if (ViewBag.AGE == "5")
                                        {
                                            <option value="5" selected="selected">50-60</option>
                                        }
                                        else
                                        {
                                            <option value="5">50-60</option>
                                        }
                                        if (ViewBag.AGE == "6")
                                        {
                                            <option value="6" selected="selected">60-70</option>
                                        }
                                        else
                                        {
                                            <option value="6">60-70</option>
                                        }
                                        if (ViewBag.AGE == "7")
                                        {
                                            <option value="7" selected="selected">70 以上</option>
                                        }
                                        else
                                        {
                                            <option value="7">70 以上</option>
                                        }
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-xs-2"></div>
                    </div>

                </div>                
            </section>

            <div class="row" style="position:fixed; bottom: 5%; width: 100%;">
                <div class="col-xs-8 col-xs-offset-2">
                    <button id="btn_next" name="btn_next" type="button" class="form-control ok-btn">下一步</button>
                </div>
            </div>           
            <br />
        </div>
    </div>

    <div id="div_wait" class="popup-content-box">
        <div style="margin:10px;">
            <img src="~/images/wait.gif" style="width:120px;height:80px;" />
            <br />
            <strong>資料傳送中</strong>
        </div>
    </div>

    <script>

    var act = '';
    var code = '';
    var acc = '';
    var tk = '';
    var m = '';
    var g = '';
    var a = '';
    var coup_number = '';
    var vaild_date = '';
    var img = '';
    var log = '';
    var CITY = '';
    var LAT = -999999;
    var LONG = -999999;

    $(document).ready(function () {

        @{

             if (!string.IsNullOrEmpty(ViewBag.ACTIVITY))
            {
                <text>
        act = '@ViewBag.ACTIVITY';
        </text>
            }

             if (!string.IsNullOrEmpty(ViewBag.CODE))
            {
                <text>
        code = '@ViewBag.CODE';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.ACC))
            {
                <text>
        acc = '@ViewBag.ACC';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.TICKET))
            {
                <text>
        tk = '@ViewBag.TICKET';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.MOBIL))
            {
                <text>
        m = '@ViewBag.MOBIL';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.GENDER))
            {
                <text>
        g = '@ViewBag.GENDER';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.AGE))
            {
                <text>
        a = '@ViewBag.AGE';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.LOG_KEY))
            {
                <text>
        log = '@ViewBag.LOG_KEY';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.RWD_COUPNUMBER))
            {
                <text>
        coup_number = '@ViewBag.RWD_COUPNUMBER';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.RWD_DATE))
            {
                <text>
        vaild_date = '@ViewBag.RWD_DATE';
        </text>
            }

            if (!string.IsNullOrEmpty(ViewBag.CITY))
             {
                 <text>
        CITY = '@ViewBag.CITY';
        </text>
             }

            if (!string.IsNullOrEmpty(ViewBag.LAT))
             {
                 <text>
        LAT = '@ViewBag.LAT';
        </text>
             }

            if (!string.IsNullOrEmpty(ViewBag.LONG))
             {
                 <text>
        LONG = '@ViewBag.LONG';
        </text>
             }

            if (!string.IsNullOrEmpty(ViewBag.RWD_IMG))
             {
                 <text>
        img = '@ViewBag.RWD_IMG';
        </text>
             }
        }

        $("#btn_next").click(function () {

            var mobil = $("#txt_mobil").val();

            if (mobil.length == 0) {
                $("#lbl_mobil").css('color', 'red');
                return false;
            } else if (mobil.length != 10) {
                $("#lbl_mobil").css('color', 'red');
                return false;
            } else {
                $("#lbl_mobil").css('color', 'black');
            }

            var needUpdate = false;

            if (m != mobil) {
                needUpdate = true;
            }

            if (needUpdate) {

                var data = "ml=" + acc + "&tk=" + tk + "&m=" + mobil;
                updateInfo(data);
            } else {
                nextStep();
            }
            

        });
    });

    function updateInfo(data) {

        $("#div_wait").show();

        $.ajax({
            async: false,
            type: "POST",
            url: '@Url.Content("~/")Register/renewAccountMobil',
            data: data,
            dataType: 'json',
            success: function (data, status, xhr) {

                jDatas = jQuery.parseJSON(data);
                if (jDatas.length == 1) {
                    if (jDatas[0].VERIFY == "1") {
                        nextStep();
                    }
                } else {
                    $("#div_wait").hide();
                    if (jDatas.ErrorMessage) {
                        alert(jDatas.ErrorMessage);
                    }
                }
            },
            error: function (request, error) {
                $("#div_wait").hide();
                alert(error + " : " + request.responseText);
            },
            complete: function () {

            }
        });

    }

    function nextStep() {

        window.location.href = '@Url.Content("~/")THC/get?act=' + act + '&code=' + code + '&tk=' + tk +
                        '&ml=' + acc + '&m=' + m + "&lk=" + log + "&coup=" + coup_number + "&type=0" +
                        '&vdate=' + vaild_date + '&img=' + img + '&city=' + CITY + '&lat=' + LAT + '&lng=' + LONG;

    }

</script>

</body>
